#!/bin/python3

from time import sleep

import client_lib


def test_for_bad_values(req, resp):
    if "PRIVATE KEY" in response_str:
        print_exploitable_and_exit4(req, resp)


def print_exploitable_and_exit4(req, resp, additional_msg=None):
    print("Exploitable: Got signers private_key:")
    print(f"Request send to server: {req}")
    print(f"Response from Server: {resp}")
    exit(4)


if __name__ == "__main__":
    request = "-Key PUBLIC_KEY"
    signer = client_lib.new_connected_socket(5421)
    client_lib.send_input_to_server(signer, request)

    sleep(1)

    publisher = client_lib.new_connected_socket(5422)
    response = client_lib.receive_bytes_from_socket(publisher)
    response_str = response.decode(encoding="utf-8", errors="ignore")
    test_for_bad_values(request, response_str)

    print("OK: Can not get the private key")
    exit(1)

